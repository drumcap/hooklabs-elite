# 쿠폰 관리 시스템 사용자 스토리

## Epic 1: 사용자 쿠폰 사용 경험

### Story: US-001 - 쿠폰 코드 입력 및 검증
**사용자로서** 일반 고객  
**기능을 원함** 쿠폰 코드를 입력하고 할인 혜택을 확인하는  
**비즈니스 가치** 쿠폰을 통해 할인된 가격으로 서비스를 이용할 수 있다

**수용 기준** (EARS 형식):
- **WHEN** 사용자가 유효한 쿠폰 코드를 입력하고 엔터를 누르면 **THEN** 할인 금액과 성공 메시지가 표시된다
- **WHEN** 사용자가 유효하지 않은 쿠폰 코드를 입력하면 **THEN** "유효하지 않은 쿠폰 코드입니다" 에러 메시지가 표시된다
- **WHEN** 사용자가 만료된 쿠폰 코드를 입력하면 **THEN** "만료된 쿠폰입니다" 에러 메시지가 표시된다
- **IF** 쿠폰에 최소 주문 금액 조건이 있다면 **THEN** 조건 미충족 시 안내 메시지가 표시된다
- **FOR** 모든 쿠폰 코드 입력 **VERIFY** 대소문자 구분 없이 처리된다

**기술적 고려사항**:
- Convex `validateCoupon` 쿼리 사용
- 실시간 검증을 위한 디바운싱 구현 (500ms)
- 쿠폰 코드 자동 대문자 변환
- 로딩 상태 표시

**스토리 포인트**: 5
**우선순위**: 높음

### Story: US-002 - 결제 페이지 쿠폰 적용
**사용자로서** 결제를 진행하는 고객  
**기능을 원함** 결제 시 쿠폰을 적용하여 할인된 가격으로 결제하는  
**비즈니스 가치** 쿠폰 혜택을 받아 비용을 절약하고 구매 전환율을 높인다

**수용 기준** (EARS 형식):
- **WHEN** 사용자가 체크아웃 페이지에서 쿠폰을 적용하면 **THEN** 할인 전/후 가격 비교가 명확히 표시된다
- **WHEN** 사용자가 적용된 쿠폰을 제거하면 **THEN** 원래 가격으로 복원된다
- **IF** 최소 주문 금액 조건이 있다면 **THEN** 조건 충족 여부가 실시간으로 표시된다
- **FOR** 모든 쿠폰 적용 **VERIFY** Lemon Squeezy 결제와 정확히 연동된다
- **WHEN** 크레딧 타입 쿠폰을 사용하면 **THEN** 크레딧 지급 확인 메시지가 표시된다

**기술적 고려사항**:
- Lemon Squeezy 체크아웃 URL에 할인 정보 전달
- 쿠폰 적용 상태 관리 (React state)
- 가격 계산 로직의 정확성 보장
- 세금 계산과의 연동

**스토리 포인트**: 8
**우선순위**: 높음

### Story: US-003 - 쿠폰 사용 내역 조회
**사용자로서** 로그인한 고객  
**기능을 원함** 본인의 쿠폰 사용 내역을 확인하는  
**비즈니스 가치** 과거 혜택 내역을 확인하고 서비스 이용 투명성을 제고한다

**수용 기준** (EARS 형식):
- **WHEN** 사용자가 쿠폰 내역 페이지에 접근하면 **THEN** 최신 사용 내역부터 시간순으로 표시된다
- **WHEN** 사용자가 특정 날짜 범위를 선택하면 **THEN** 해당 기간의 내역만 필터링되어 표시된다
- **IF** 내역이 20개를 초과하면 **THEN** 페이지네이션 또는 "더보기" 버튼이 제공된다
- **FOR** 각 사용 내역 **VERIFY** 쿠폰 코드, 할인 금액, 사용 날짜가 정확히 표시된다
- **WHEN** 사용자가 내보내기를 클릭하면 **THEN** CSV 파일로 다운로드된다

**기술적 고려사항**:
- Convex `getUserCouponUsages` 쿼리 사용
- 무한 스크롤 또는 페이지네이션 구현
- 날짜 필터링 UI 컴포넌트
- CSV 내보내기 기능

**스토리 포인트**: 5
**우선순위**: 중간

## Epic 2: 관리자 쿠폰 관리

### Story: US-004 - 관리자 쿠폰 대시보드 조회
**사용자로서** 시스템 관리자  
**기능을 원함** 모든 쿠폰의 현황을 한눈에 파악하는  
**비즈니스 가치** 쿠폰 운영 상태를 모니터링하고 비즈니스 의사결정을 지원한다

**수용 기준** (EARS 형식):
- **WHEN** 관리자가 쿠폰 대시보드에 접근하면 **THEN** 전체 쿠폰 목록이 테이블 형태로 표시된다
- **WHEN** 관리자가 상태 필터를 선택하면 **THEN** 활성/비활성/만료 쿠폰만 표시된다
- **WHEN** 관리자가 검색어를 입력하면 **THEN** 쿠폰 코드/이름/설명에서 일치하는 결과가 표시된다
- **IF** 쿠폰이 100개를 초과하면 **THEN** 페이지네이션이 제공된다
- **FOR** 각 쿠폰 항목 **VERIFY** 코드, 이름, 타입, 사용률, 상태, 만료일이 표시된다

**기술적 고려사항**:
- Clerk 관리자 권한 검증 (`role: 'admin'`)
- Convex `getAllCoupons` 쿼리 사용
- 실시간 데이터 동기화
- 대량 데이터 처리를 위한 가상화

**스토리 포인트**: 8
**우선순위**: 높음

### Story: US-005 - 새 쿠폰 생성
**사용자로서** 마케팅 관리자  
**기능을 원함** 프로모션을 위한 새로운 쿠폰을 생성하는  
**비즈니스 가치** 마케팅 캠페인을 효과적으로 실행하고 고객 유치를 도모한다

**수용 기준** (EARS 형식):
- **WHEN** 관리자가 쿠폰 생성 폼을 작성하고 제출하면 **THEN** 새 쿠폰이 데이터베이스에 저장된다
- **WHEN** 관리자가 중복된 쿠폰 코드를 입력하면 **THEN** "이미 존재하는 쿠폰 코드입니다" 에러가 표시된다
- **IF** 필수 필드가 누락되면 **THEN** 해당 필드에 에러 메시지가 표시된다
- **FOR** 모든 쿠폰 타입 **VERIFY** 퍼센트, 고정 금액, 크레딧 타입 모두 지원된다
- **WHEN** 관리자가 코드 자동 생성을 클릭하면 **THEN** 유니크한 8자리 코드가 생성된다

**기술적 고려사항**:
- Convex `createCoupon` 뮤테이션 사용
- React Hook Form과 Zod 검증
- 쿠폰 코드 자동 생성 알고리즘
- 날짜 선택기 컴포넌트

**스토리 포인트**: 8
**우선순위**: 높음

### Story: US-006 - 기존 쿠폰 편집
**사용자로서** 시스템 관리자  
**기능을 원함** 기존 쿠폰의 정보를 수정하는  
**비즈니스 가치** 운영 중인 쿠폰을 유연하게 조정하고 비즈니스 요구에 대응한다

**수용 기준** (EARS 형식):
- **WHEN** 관리자가 쿠폰 편집 모달을 열면 **THEN** 현재 쿠폰 정보가 폼에 미리 채워진다
- **WHEN** 관리자가 수정사항을 저장하면 **THEN** 변경 내역이 실시간으로 반영된다
- **IF** 이미 사용된 쿠폰이라면 **THEN** 코드와 타입은 수정 불가능하다
- **FOR** 수정 가능한 필드 **VERIFY** 이름, 설명, 사용 한도, 유효 기간, 활성 상태만 변경 가능하다
- **WHEN** 쿠폰을 비활성화하면 **THEN** 확인 대화상자가 표시된다

**기술적 고려사항**:
- Convex `updateCoupon` 뮤테이션 사용
- 편집 권한 로직 구현
- 변경 불가 필드 비활성화
- 확인 대화상자 컴포넌트

**스토리 포인트**: 6
**우선순위**: 중간

### Story: US-007 - 쿠폰 통계 및 분석
**사용자로서** 마케팅 분석가  
**기능을 원함** 쿠폰별 성과를 분석하는  
**비즈니스 가치** 데이터 기반으로 마케팅 효과를 측정하고 개선점을 도출한다

**수용 기준** (EARS 형식):
- **WHEN** 관리자가 쿠폰 상세 페이지에 접근하면 **THEN** 해당 쿠폰의 상세 통계가 표시된다
- **WHEN** 관리자가 기간을 선택하면 **THEN** 해당 기간의 사용 패턴 차트가 표시된다
- **IF** 쿠폰 사용 데이터가 있다면 **THEN** 일별/주별/월별 사용량 그래프가 표시된다
- **FOR** 각 통계 항목 **VERIFY** 총 사용 횟수, 할인 금액, 고유 사용자 수, 잔여 사용량이 표시된다
- **WHEN** 관리자가 내보내기를 클릭하면 **THEN** 통계 데이터가 Excel/CSV로 다운로드된다

**기술적 고려사항**:
- Convex `getCouponStats` 쿼리 사용
- Chart.js 또는 Recharts 차트 라이브러리
- 날짜 범위 선택기
- 데이터 내보내기 기능

**스토리 포인트**: 8
**우선순위**: 중간

## Epic 3: 시스템 통합 및 실시간 기능

### Story: US-008 - 실시간 데이터 동기화
**사용자로서** 관리자  
**기능을 원함** 쿠폰 데이터 변경사항이 실시간으로 반영되는  
**비즈니스 가치** 정확한 실시간 정보로 운영 효율성을 높이고 데이터 일관성을 보장한다

**수용 기준** (EARS 형식):
- **WHEN** 다른 관리자가 쿠폰을 생성/수정하면 **THEN** 대시보드에 변경사항이 즉시 반영된다
- **WHEN** 사용자가 쿠폰을 사용하면 **THEN** 사용량이 실시간으로 업데이트된다
- **IF** 네트워크 연결이 끊어진다면 **THEN** 재연결 시 최신 상태로 동기화된다
- **FOR** 모든 실시간 업데이트 **VERIFY** 5초 이내에 반영된다
- **WHEN** 쿠폰이 사용 한도에 도달하면 **THEN** 상태가 즉시 "완료"로 변경된다

**기술적 고려사항**:
- Convex 실시간 구독 기능 활용
- 연결 상태 모니터링
- 낙관적 업데이트와 에러 롤백
- WebSocket 연결 관리

**스토리 포인트**: 5
**우선순위**: 높음

### Story: US-009 - 모바일 반응형 UI
**사용자로서** 모바일 디바이스 사용자  
**기능을 원함** 모바일에서도 쿠폰 기능을 편리하게 이용하는  
**비즈니스 가치** 모든 디바이스에서 일관된 사용자 경험을 제공하고 접근성을 높인다

**수용 기준** (EARS 형식):
- **WHEN** 사용자가 모바일에서 쿠폰 페이지에 접근하면 **THEN** 화면 크기에 맞게 레이아웃이 조정된다
- **WHEN** 사용자가 터치로 쿠폰 코드를 입력하면 **THEN** 가상 키보드가 적절히 표시된다
- **IF** 화면이 768px 미만이라면 **THEN** 관리자 테이블이 카드 형태로 변경된다
- **FOR** 모든 터치 이벤트 **VERIFY** 44px 이상의 터치 영역을 확보한다
- **WHEN** 세로/가로 모드를 전환하면 **THEN** 레이아웃이 자연스럽게 재조정된다

**기술적 고려사항**:
- TailwindCSS 반응형 클래스 활용
- 터치 디바이스 최적화
- 가상 키보드 대응
- PWA 고려사항

**스토리 포인트**: 6
**우선순위**: 중간

### Story: US-010 - 접근성 준수
**사용자로서** 시각/청각 장애가 있는 사용자  
**기능을 원함** 보조 기술을 통해 쿠폰 기능을 이용하는  
**비즈니스 가치** 포용적인 서비스를 제공하고 법적 요구사항을 준수한다

**수용 기준** (EARS 형식):
- **WHEN** 스크린 리더 사용자가 쿠폰 폼을 탐색하면 **THEN** 모든 요소가 의미있게 읽혀진다
- **WHEN** 키보드만으로 탐색하면 **THEN** 모든 기능에 접근 가능하다
- **IF** 에러가 발생하면 **THEN** 스크린 리더가 에러 내용을 안내한다
- **FOR** 모든 색상 정보 **VERIFY** 색상에만 의존하지 않는 시각적 구분 요소가 있다
- **WHEN** 폰트 크기를 200%까지 확대하면 **THEN** 레이아웃이 깨지지 않는다

**기술적 고려사항**:
- ARIA 레이블 및 역할 속성
- 시맨틱 HTML 마크업
- 키보드 탐색 순서
- 색상 대비 비율 4.5:1 이상
- Focus 표시 개선

**스토리 포인트**: 5
**우선순위**: 중간

---

## 우선순위 매트릭스

### 높은 우선순위 (Sprint 1-2)
- US-001: 쿠폰 코드 입력 및 검증
- US-002: 결제 페이지 쿠폰 적용  
- US-004: 관리자 쿠폰 대시보드 조회
- US-005: 새 쿠폰 생성
- US-008: 실시간 데이터 동기화

### 중간 우선순위 (Sprint 3-4)
- US-003: 쿠폰 사용 내역 조회
- US-006: 기존 쿠폰 편집
- US-007: 쿠폰 통계 및 분석
- US-009: 모바일 반응형 UI
- US-010: 접근성 준수

## 정의 완료 (Definition of Done)

각 사용자 스토리는 다음 조건을 만족해야 완료로 간주됩니다:

✅ **기능 완성도**
- 모든 수용 기준이 구현되고 테스트됨
- 에러 처리 및 예외 상황 대응 완료
- 로딩 상태 및 사용자 피드백 구현

✅ **품질 보증**
- 단위 테스트 작성 및 통과 (80% 이상 커버리지)
- 통합 테스트 작성 및 통과
- E2E 테스트 시나리오 작성 및 통과
- 코드 리뷰 완료

✅ **사용자 경험**
- 디자인 가이드라인 준수
- 접근성 테스트 통과 (WAVE, axe-core)
- 다양한 디바이스에서 테스트 완료
- 성능 요구사항 만족 (Core Web Vitals)

✅ **문서화**
- 컴포넌트 문서화 (Storybook)
- API 통합 방법 문서화
- 에러 케이스 및 해결 방법 문서화

---

**문서 버전**: v1.0  
**작성일**: 2025년 9월 3일  
**작성자**: Product Owner  
**검토자**: [검토 예정]  
**승인자**: [승인 예정]