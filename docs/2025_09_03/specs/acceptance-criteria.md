# 쿠폰 관리 시스템 수용 기준 (Acceptance Criteria)

## 개요

이 문서는 쿠폰 관리 시스템의 각 기능에 대한 구체적이고 테스트 가능한 수용 기준을 정의합니다. 모든 기준은 Given-When-Then (GWT) 또는 EARS (Event-Action-Response-State) 형식으로 작성되어 있습니다.

## AC-001: 쿠폰 코드 입력 및 검증

### AC-001.1: 유효한 쿠폰 코드 검증
**Given**: 사용자가 쿠폰 입력 페이지에 있고  
**When**: 유효한 쿠폰 코드 "SAVE20"을 입력하고 검증 버튼을 클릭하면  
**Then**: 
- 할인 금액이 "20% 할인 (최대 10,000원)" 형태로 표시되어야 함
- 성공 아이콘(녹색 체크)이 표시되어야 함
- "쿠폰이 성공적으로 적용되었습니다" 메시지가 표시되어야 함
- 적용 버튼이 활성화되어야 함

### AC-001.2: 유효하지 않은 쿠폰 코드 검증
**Given**: 사용자가 쿠폰 입력 필드에 포커스하고  
**When**: 존재하지 않는 쿠폰 코드 "INVALID123"을 입력하면  
**Then**:
- 빨간색 에러 아이콘이 표시되어야 함
- "유효하지 않은 쿠폰 코드입니다" 에러 메시지가 표시되어야 함
- 입력 필드 테두리가 빨간색으로 변경되어야 함
- 적용 버튼이 비활성화되어야 함

### AC-001.3: 만료된 쿠폰 검증
**Given**: 시스템에 2025년 8월 31일에 만료된 쿠폰 "EXPIRED10"이 있고  
**When**: 2025년 9월 1일에 해당 코드를 입력하면  
**Then**:
- "만료된 쿠폰입니다" 에러 메시지가 표시되어야 함
- 쿠폰 만료일이 "2025년 8월 31일 만료" 형태로 표시되어야 함

### AC-001.4: 최소 주문 금액 미달
**Given**: 최소 주문 금액 50,000원인 쿠폰 "MIN50K"가 있고  
**When**: 30,000원 주문에 해당 쿠폰을 적용하려고 하면  
**Then**:
- "최소 주문 금액 50,000원 이상이어야 합니다" 에러 메시지가 표시되어야 함
- 현재 주문 금액과 필요 금액의 차이가 "20,000원 더 주문하시면 사용 가능합니다" 형태로 안내되어야 함

### AC-001.5: 사용 한도 초과
**Given**: 100번 사용 한도인 쿠폰 "LIMIT100"이 이미 100번 사용되었고  
**When**: 101번째 사용자가 해당 쿠폰을 적용하려고 하면  
**Then**:
- "사용 횟수가 초과된 쿠폰입니다" 에러 메시지가 표시되어야 함
- "이 쿠폰은 한정 수량으로 제공되었으며, 현재 모두 소진되었습니다" 안내문이 표시되어야 함

### AC-001.6: 대소문자 구분 없는 처리
**Given**: 시스템에 "WELCOME10" 쿠폰이 등록되어 있고  
**When**: 사용자가 "welcome10", "Welcome10", "WELCOME10" 중 어떤 것을 입력해도  
**Then**:
- 모두 동일한 쿠폰으로 인식되어야 함
- 입력된 텍스트가 자동으로 대문자로 변환되어야 함

## AC-002: 결제 페이지 쿠폰 적용

### AC-002.1: 체크아웃 페이지 쿠폰 적용
**Given**: 사용자가 50,000원 상품의 체크아웃 페이지에 있고  
**When**: 20% 할인 쿠폰 "SAVE20"을 적용하면  
**Then**:
- 할인 전 가격: "50,000원"이 취소선과 함께 표시되어야 함
- 할인 금액: "-10,000원 (SAVE20 쿠폰)"이 표시되어야 함
- 최종 결제 금액: "40,000원"이 강조되어 표시되어야 함
- Lemon Squeezy 체크아웃 URL에 할인 정보가 포함되어야 함

### AC-002.2: 쿠폰 제거 기능
**Given**: 쿠폰이 적용된 체크아웃 페이지에서  
**When**: "쿠폰 제거" 버튼을 클릭하면  
**Then**:
- 할인 금액 표시가 사라져야 함
- 원래 가격으로 복원되어야 함
- 쿠폰 입력 필드가 초기화되어야 함
- "쿠폰이 제거되었습니다" 확인 메시지가 표시되어야 함

### AC-002.3: 크레딧 타입 쿠폰 처리
**Given**: 1,000 크레딧을 지급하는 "CREDIT1000" 쿠폰이 있고  
**When**: 사용자가 해당 쿠폰을 사용하면  
**Then**:
- "1,000 크레딧이 지급됩니다" 안내 메시지가 표시되어야 함
- 결제 완료 후 크레딧 잔액이 실시간으로 업데이트되어야 함
- 크레딧 지급 내역이 별도로 기록되어야 함

## AC-003: 쿠폰 사용 내역 조회

### AC-003.1: 사용 내역 목록 표시
**Given**: 사용자가 3개의 쿠폰을 사용한 내역이 있고  
**When**: 쿠폰 사용 내역 페이지에 접근하면  
**Then**:
- 최신 사용 내역부터 시간순으로 정렬되어 표시되어야 함
- 각 내역은 쿠폰 코드, 할인 금액, 사용 날짜, 쿠폰 이름을 포함해야 함
- 사용 날짜는 "2025년 9월 3일 14:30" 형태로 표시되어야 함
- 할인 금액은 통화 기호와 함께 "10,000원" 형태로 표시되어야 함

### AC-003.2: 날짜 필터링
**Given**: 2025년 8월과 9월에 각각 쿠폰 사용 내역이 있고  
**When**: "2025년 9월" 필터를 선택하면  
**Then**:
- 9월 내역만 표시되어야 함
- 필터 적용 상태가 "2025년 9월 (2건)" 형태로 표시되어야 함
- 필터 초기화 버튼이 제공되어야 함

### AC-003.3: 페이지네이션
**Given**: 사용자에게 25개의 쿠폰 사용 내역이 있고  
**When**: 내역 페이지를 방문하면  
**Then**:
- 첫 페이지에 20개 내역이 표시되어야 함
- "더 보기" 버튼 또는 페이지 번호가 표시되어야 함
- 다음 페이지를 클릭하면 나머지 5개 내역이 로드되어야 함

### AC-003.4: CSV 내보내기
**Given**: 사용자가 쿠폰 사용 내역 페이지에 있고  
**When**: "CSV 내보내기" 버튼을 클릭하면  
**Then**:
- "coupon_usage_history_2025_09_03.csv" 파일이 다운로드되어야 함
- CSV 파일에는 헤더행과 모든 사용 내역이 포함되어야 함
- 한글이 깨지지 않고 올바르게 인코딩되어야 함

## AC-004: 관리자 쿠폰 대시보드

### AC-004.1: 관리자 권한 검증
**Given**: 일반 사용자가 관리자 대시보드 URL에 접근하려고 하면  
**When**: 페이지 로드가 시작되면  
**Then**:
- Clerk의 `publicMetadata.role`이 'admin'이 아니면 접근이 거부되어야 함
- "접근 권한이 없습니다" 메시지와 함께 홈페이지로 리다이렉트되어야 함

### AC-004.2: 쿠폰 목록 테이블
**Given**: 관리자가 쿠폰 대시보드에 접근하고  
**When**: 페이지가 로드되면  
**Then**:
- 테이블 헤더: 쿠폰 코드, 이름, 타입, 사용률, 상태, 만료일, 작업이 표시되어야 함
- 각 행은 해당 쿠폰의 정보를 포함해야 함
- 사용률은 "15/100 (15%)" 형태로 표시되어야 함
- 상태는 색상 코딩된 뱃지로 표시되어야 함 (활성: 녹색, 만료: 빨강, 비활성: 회색)

### AC-004.3: 상태별 필터링
**Given**: 활성 쿠폰 5개, 비활성 쿠폰 3개, 만료된 쿠폰 2개가 있고  
**When**: "활성" 필터를 선택하면  
**Then**:
- 5개의 활성 쿠폰만 표시되어야 함
- 필터 버튼에 "활성 (5)" 개수가 표시되어야 함
- URL 파라미터가 `?status=active`로 업데이트되어야 함

### AC-004.4: 검색 기능
**Given**: 관리자가 쿠폰 대시보드에서  
**When**: 검색창에 "WELCOME"을 입력하면  
**Then**:
- 쿠폰 코드, 이름, 설명에 "WELCOME"이 포함된 쿠폰만 표시되어야 함
- 검색 결과 개수가 "3개 결과 찾음" 형태로 표시되어야 함
- 검색어가 강조 표시되어야 함

### AC-004.5: 정렬 기능
**Given**: 관리자가 쿠폰 목록에서  
**When**: "사용률" 컬럼 헤더를 클릭하면  
**Then**:
- 사용률이 높은 순으로 정렬되어야 함
- 컬럼 헤더에 정렬 방향 화살표가 표시되어야 함
- 다시 클릭하면 낮은 순으로 재정렬되어야 함

## AC-005: 쿠폰 생성 및 편집

### AC-005.1: 쿠폰 생성 폼 검증
**Given**: 관리자가 쿠폰 생성 모달을 열고  
**When**: 필수 필드(코드, 이름, 타입, 값)를 모두 채우고 제출하면  
**Then**:
- 새 쿠폰이 데이터베이스에 저장되어야 함
- "쿠폰이 성공적으로 생성되었습니다" 성공 메시지가 표시되어야 함
- 모달이 닫히고 대시보드 목록에 새 쿠폰이 추가되어야 함
- 생성된 쿠폰은 "활성" 상태여야 함

### AC-005.2: 중복 코드 검증
**Given**: 이미 "SAVE20" 쿠폰이 존재하고  
**When**: 관리자가 동일한 "SAVE20" 코드로 새 쿠폰을 생성하려고 하면  
**Then**:
- "이미 존재하는 쿠폰 코드입니다" 에러 메시지가 표시되어야 함
- 쿠폰 코드 필드에 빨간색 테두리가 표시되어야 함
- 폼 제출이 차단되어야 함

### AC-005.3: 쿠폰 타입별 필드 표시
**Given**: 관리자가 쿠폰 생성 폼에서  
**When**: 쿠폰 타입을 "percentage"로 선택하면  
**Then**:
- "최대 할인 금액" 필드가 표시되어야 함
- 값 필드 라벨이 "할인율 (%)"로 변경되어야 함
- 값 입력 시 1-100 범위로 제한되어야 함

**When**: 쿠폰 타입을 "fixed_amount"로 선택하면  
**Then**:
- "최대 할인 금액" 필드가 숨겨져야 함
- 값 필드 라벨이 "할인 금액 (원)"으로 변경되어야 함

**When**: 쿠폰 타입을 "credits"로 선택하면  
**Then**:
- 값 필드 라벨이 "크레딧 양"으로 변경되어야 함
- 통화 관련 필드들이 숨겨져야 함

### AC-005.4: 자동 쿠폰 코드 생성
**Given**: 관리자가 쿠폰 생성 폼에서  
**When**: "코드 자동 생성" 버튼을 클릭하면  
**Then**:
- 8자리 영문자+숫자 조합 코드가 생성되어야 함
- 생성된 코드는 기존 쿠폰과 중복되지 않아야 함
- 코드는 "ABC12XYZ" 형태의 대문자로 생성되어야 함

### AC-005.5: 쿠폰 편집 제한사항
**Given**: 이미 5번 사용된 "USED5TIMES" 쿠폰이 있고  
**When**: 관리자가 해당 쿠폰을 편집하려고 하면  
**Then**:
- 쿠폰 코드 필드가 읽기 전용으로 비활성화되어야 함
- 쿠폰 타입 필드가 읽기 전용으로 비활성화되어야 함
- 할인 값 필드가 읽기 전용으로 비활성화되어야 함
- "이미 사용된 쿠폰은 코드, 타입, 값을 변경할 수 없습니다" 안내 메시지가 표시되어야 함

## AC-006: 쿠폰 통계 및 분석

### AC-006.1: 쿠폰 상세 통계 표시
**Given**: "SAVE20" 쿠폰이 50번 사용되어 총 500,000원 할인을 제공했고  
**When**: 관리자가 해당 쿠폰의 상세 페이지에 접근하면  
**Then**:
- 총 사용 횟수: "50회"가 표시되어야 함
- 총 할인 금액: "500,000원"이 표시되어야 함
- 고유 사용자 수: 사용한 고유 사용자 수가 표시되어야 함
- 잔여 사용량: "사용 한도 - 사용 횟수"가 계산되어 표시되어야 함

### AC-006.2: 시간별 사용 패턴 차트
**Given**: 쿠폰 사용 데이터가 최근 30일간 있고  
**When**: 관리자가 "최근 30일" 기간을 선택하면  
**Then**:
- 일별 사용량이 선 그래프로 표시되어야 함
- X축은 날짜, Y축은 사용 횟수여야 함
- 마우스 호버 시 해당 날짜의 상세 정보가 툴팁으로 표시되어야 함
- 차트 색상은 브랜드 색상을 따라야 함

### AC-006.3: 통계 데이터 내보내기
**Given**: 관리자가 쿠폰 통계 페이지에서  
**When**: "Excel로 내보내기" 버튼을 클릭하면  
**Then**:
- 쿠폰 기본 정보와 통계 데이터가 포함된 Excel 파일이 다운로드되어야 함
- 파일명은 "쿠폰통계_SAVE20_20250903.xlsx" 형태여야 함
- 차트 이미지도 Excel에 포함되어야 함

## AC-007: 실시간 데이터 동기화

### AC-007.1: 실시간 사용량 업데이트
**Given**: 관리자가 쿠폰 대시보드를 보고 있고  
**When**: 다른 사용자가 "SAVE20" 쿠폰을 사용하면  
**Then**:
- 3초 이내에 대시보드의 사용률이 업데이트되어야 함
- 업데이트된 셀이 잠깐 강조 표시(플래시 효과)되어야 함
- 사용량이 한도에 도달하면 상태가 "완료"로 변경되어야 함

### AC-007.2: 여러 관리자 동시 작업
**Given**: 두 명의 관리자가 동시에 쿠폰 대시보드를 보고 있고  
**When**: 한 관리자가 쿠폰을 비활성화하면  
**Then**:
- 다른 관리자의 화면에서도 즉시 상태가 "비활성"으로 변경되어야 함
- 충돌 없이 변경사항이 반영되어야 함

### AC-007.3: 연결 끊김 처리
**Given**: 관리자가 대시보드를 사용 중 인터넷 연결이 끊어졌고  
**When**: 연결이 복구되면  
**Then**:
- 5초 이내에 자동으로 재연결되어야 함
- 최신 데이터로 자동 동기화되어야 함
- "연결이 복구되었습니다" 알림이 표시되어야 함

## AC-008: 모바일 반응형 UI

### AC-008.1: 모바일 쿠폰 입력 인터페이스
**Given**: 사용자가 모바일 디바이스(375px 너비)에서  
**When**: 쿠폰 입력 페이지에 접근하면  
**Then**:
- 쿠폰 입력 필드가 화면 너비의 90%를 차지해야 함
- 적용 버튼이 입력 필드 아래 전체 너비로 표시되어야 함
- 터치 영역이 최소 44px 높이를 유지해야 함
- 가상 키보드 표시 시 레이아웃이 깨지지 않아야 함

### AC-008.2: 관리자 대시보드 모바일 뷰
**Given**: 관리자가 모바일에서 쿠폰 대시보드에 접근하면  
**When**: 화면 너비가 768px 미만이면  
**Then**:
- 테이블이 카드 형태의 리스트로 변경되어야 함
- 각 카드에는 쿠폰 코드, 이름, 상태, 사용률이 표시되어야 함
- 작업 버튼들이 카드 하단에 가로로 정렬되어야 함
- 스와이프 제스처로 추가 작업에 접근할 수 있어야 함

### AC-008.3: 터치 인터랙션 최적화
**Given**: 사용자가 터치 디바이스에서  
**When**: 버튼이나 링크를 터치하면  
**Then**:
- 터치 피드백(ripple effect)이 표시되어야 함
- 터치 영역이 44px × 44px 이상이어야 함
- 더블 탭으로 인한 의도치 않은 확대가 방지되어야 함

## AC-009: 접근성 준수

### AC-009.1: 스크린 리더 호환성
**Given**: 시각 장애 사용자가 스크린 리더를 사용하여  
**When**: 쿠폰 입력 폼을 탐색하면  
**Then**:
- 모든 입력 필드에 적절한 label이 연결되어야 함
- 에러 메시지가 `aria-describedby`로 연결되어 스크린 리더가 읽어야 함
- 폼 제출 결과가 `aria-live` 영역으로 안내되어야 함
- 버튼의 역할과 상태가 명확히 전달되어야 함

### AC-009.2: 키보드 탐색
**Given**: 사용자가 키보드만 사용하여  
**When**: 쿠폰 관리 페이지를 탐색하면  
**Then**:
- Tab 키로 모든 상호작용 요소에 순차적으로 접근할 수 있어야 함
- 현재 포커스된 요소가 명확히 시각적으로 구분되어야 함
- Enter/Space 키로 버튼을 활성화할 수 있어야 함
- Escape 키로 모달을 닫을 수 있어야 함

### AC-009.3: 색상 접근성
**Given**: 색각 이상자가 쿠폰 상태를 확인할 때  
**When**: 대시보드에서 쿠폰 목록을 보면  
**Then**:
- 활성/비활성 상태가 색상뿐만 아니라 아이콘으로도 구분되어야 함
- 성공/에러 메시지가 색상뿐만 아니라 텍스트로도 구분되어야 함
- 모든 텍스트-배경 색상 조합이 4.5:1 이상의 대비율을 유지해야 함

### AC-009.4: 화면 확대 지원
**Given**: 사용자가 브라우저 확대를 200%까지 설정했을 때  
**When**: 쿠폰 페이지들을 탐색하면  
**Then**:
- 모든 텍스트와 UI 요소가 잘리지 않고 표시되어야 함
- 가로 스크롤이 발생하지 않아야 함
- 모든 기능이 정상적으로 작동해야 함

---

## 테스트 실행 가이드

### 자동 테스트 매핑
각 수용 기준은 다음과 같은 테스트 유형으로 검증됩니다:

- **단위 테스트**: 개별 함수 및 컴포넌트 로직
- **통합 테스트**: Convex 쿼리/뮤테이션과의 연동
- **E2E 테스트**: 사용자 플로우 전체 검증
- **접근성 테스트**: axe-core, WAVE 도구 활용
- **시각적 회귀 테스트**: Percy, Chromatic 활용

### 테스트 데이터 요구사항
테스트 실행을 위해 다음 데이터가 필요합니다:

```javascript
// 테스트 쿠폰 데이터
const testCoupons = [
  {
    code: "SAVE20",
    name: "20% 할인 쿠폰",
    type: "percentage",
    value: 20,
    maxDiscount: 10000,
    isActive: true,
    usageLimit: 100,
    usageCount: 15
  },
  {
    code: "EXPIRED10",
    name: "만료된 쿠폰",
    type: "percentage", 
    value: 10,
    isActive: true,
    validUntil: "2025-08-31T23:59:59.999Z"
  },
  // ... 기타 테스트 케이스
];
```

---

**문서 버전**: v1.0  
**작성일**: 2025년 9월 3일  
**작성자**: QA Engineer  
**검토자**: [검토 예정]  
**승인자**: [승인 예정]